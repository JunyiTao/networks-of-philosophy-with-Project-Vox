/* Copyright 2022 Observable, Inc. */
function e(e,t,n){n=n||{};var r=e.ownerDocument,o=r.defaultView.CustomEvent;"function"==typeof o?o=new o(t,{detail:n}):((o=r.createEvent("Event")).initEvent(t,!1,!1),o.detail=n),e.dispatchEvent(o)}function t(e){return Array.isArray(e)||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function n(e){return e===(0|e)+""}function r(e){const t=document.createElement("span");return t.className="observablehq--cellname",t.textContent=`${e} = `,t}const o=Symbol.prototype.toString;function i(e){return o.call(e)}const{getOwnPropertySymbols:a,prototype:{hasOwnProperty:s}}=Object,{toStringTag:c}=Symbol,l={},u=a;function d(e,t){return s.call(e,t)}function f(e){return e[c]||e.constructor&&e.constructor.name||"Object"}function p(e,t){try{const n=e[t];return n&&n.constructor,n}catch(e){return l}}const h=[{symbol:"@@__IMMUTABLE_INDEXED__@@",name:"Indexed",modifier:!0},{symbol:"@@__IMMUTABLE_KEYED__@@",name:"Keyed",modifier:!0},{symbol:"@@__IMMUTABLE_LIST__@@",name:"List",arrayish:!0},{symbol:"@@__IMMUTABLE_MAP__@@",name:"Map"},{symbol:"@@__IMMUTABLE_ORDERED__@@",name:"Ordered",modifier:!0,prefix:!0},{symbol:"@@__IMMUTABLE_RECORD__@@",name:"Record"},{symbol:"@@__IMMUTABLE_SET__@@",name:"Set",arrayish:!0,setish:!0},{symbol:"@@__IMMUTABLE_STACK__@@",name:"Stack",arrayish:!0}];function m(e){try{let t=h.filter((({symbol:t})=>!0===e[t]));if(!t.length)return;const n=t.find((e=>!e.modifier)),r="Map"===n.name&&t.find((e=>e.modifier&&e.prefix)),o=t.some((e=>e.arrayish)),i=t.some((e=>e.setish));return{name:`${r?r.name:""}${n.name}`,symbols:t,arrayish:o&&!i,setish:i}}catch(e){return null}}const{getPrototypeOf:b,getOwnPropertyDescriptors:v}=Object,y=b({});function w(n,o,i,a){let s,c,l,u,d=t(n);n instanceof Map?n instanceof n.constructor?(s=`Map(${n.size})`,c=_):(s="Map()",c=k):n instanceof Set?n instanceof n.constructor?(s=`Set(${n.size})`,c=g):(s="Set()",c=k):d?(s=`${n.constructor.name}(${n.length})`,c=x):(u=m(n))?(s=`Immutable.${u.name}${"Record"===u.name?"":`(${n.size})`}`,d=u.arrayish,c=u.arrayish?C:u.setish?E:N):a?(s=f(n),c=j):(s=f(n),c=k);const p=document.createElement("span");p.className="observablehq--expanded",i&&p.appendChild(r(i));const h=p.appendChild(document.createElement("a"));h.innerHTML="<svg width=8 height=8 class='observablehq--caret'>\n    <path d='M4 7L0 1h8z' fill='currentColor' />\n  </svg>",h.appendChild(document.createTextNode(`${s}${d?" [":" {"}`)),h.addEventListener("mouseup",(function(e){e.stopPropagation(),ae(p,$(n,null,i,a))})),c=c(n);for(let e=0;!(l=c.next()).done&&e<20;++e)p.appendChild(l.value);if(!l.done){const t=p.appendChild(document.createElement("a"));t.className="observablehq--field",t.style.display="block",t.appendChild(document.createTextNode("  … more")),t.addEventListener("mouseup",(function(t){t.stopPropagation(),p.insertBefore(l.value,p.lastChild.previousSibling);for(let e=0;!(l=c.next()).done&&e<19;++e)p.insertBefore(l.value,p.lastChild.previousSibling);l.done&&p.removeChild(p.lastChild.previousSibling),e(p,"load")}))}return p.appendChild(document.createTextNode(d?"]":"}")),p}function*_(e){for(const[t,n]of e)yield T(t,n);yield*k(e)}function*g(e){for(const t of e)yield O(t);yield*k(e)}function*E(e){for(const t of e)yield O(t)}function*x(e){for(let t=0,n=e.length;t<n;++t)t in e&&(yield q(t,p(e,t),"observablehq--index"));for(const t in e)!n(t)&&d(e,t)&&(yield q(t,p(e,t),"observablehq--key"));for(const t of u(e))yield q(i(t),p(e,t),"observablehq--symbol")}function*C(e){let t=0;for(const n=e.size;t<n;++t)yield q(t,e.get(t),!0)}function*j(e){for(const t in v(e))yield q(t,p(e,t),"observablehq--key");for(const t of u(e))yield q(i(t),p(e,t),"observablehq--symbol");const t=b(e);t&&t!==y&&(yield S(t))}function*k(e){for(const t in e)d(e,t)&&(yield q(t,p(e,t),"observablehq--key"));for(const t of u(e))yield q(i(t),p(e,t),"observablehq--symbol");const t=b(e);t&&t!==y&&(yield S(t))}function*N(e){for(const[t,n]of e)yield q(t,n,"observablehq--key")}function S(e){const t=document.createElement("div"),n=t.appendChild(document.createElement("span"));return t.className="observablehq--field",n.className="observablehq--prototype-key",n.textContent="  <prototype>",t.appendChild(document.createTextNode(": ")),t.appendChild(ie(e,void 0,void 0,void 0,!0)),t}function q(e,t,n){const r=document.createElement("div"),o=r.appendChild(document.createElement("span"));return r.className="observablehq--field",o.className=n,o.textContent=`  ${e}`,r.appendChild(document.createTextNode(": ")),r.appendChild(ie(t)),r}function T(e,t){const n=document.createElement("div");return n.className="observablehq--field",n.appendChild(document.createTextNode("  ")),n.appendChild(ie(e)),n.appendChild(document.createTextNode(" => ")),n.appendChild(ie(t)),n}function O(e){const t=document.createElement("div");return t.className="observablehq--field",t.appendChild(document.createTextNode("  ")),t.appendChild(ie(e)),t}function A(e){const t=window.getSelection();return"Range"===t.type&&(t.containsNode(e,!0)||t.anchorNode.isSelfOrDescendant(e)||t.focusNode.isSelfOrDescendant(e))}function $(e,n,o,i){let a,s,c,l,u=t(e);if(e instanceof Map?e instanceof e.constructor?(a=`Map(${e.size})`,s=L):(a="Map()",s=I):e instanceof Set?e instanceof e.constructor?(a=`Set(${e.size})`,s=P):(a="Set()",s=I):u?(a=`${e.constructor.name}(${e.length})`,s=U):(l=m(e))?(a=`Immutable.${l.name}${"Record"===l.name?"":`(${e.size})`}`,u=l.arrayish,s=l.arrayish?R:l.setish?M:D):(a=f(e),s=I),n){const t=document.createElement("span");return t.className="observablehq--shallow",o&&t.appendChild(r(o)),t.appendChild(document.createTextNode(a)),t.addEventListener("mouseup",(function(n){A(t)||(n.stopPropagation(),ae(t,$(e)))})),t}const d=document.createElement("span");d.className="observablehq--collapsed",o&&d.appendChild(r(o));const p=d.appendChild(document.createElement("a"));p.innerHTML="<svg width=8 height=8 class='observablehq--caret'>\n    <path d='M7 4L1 8V0z' fill='currentColor' />\n  </svg>",p.appendChild(document.createTextNode(`${a}${u?" [":" {"}`)),d.addEventListener("mouseup",(function(t){A(d)||(t.stopPropagation(),ae(d,w(e,0,o,i)))}),!0),s=s(e);for(let e=0;!(c=s.next()).done&&e<20;++e)e>0&&d.appendChild(document.createTextNode(", ")),d.appendChild(c.value);return c.done||d.appendChild(document.createTextNode(", …")),d.appendChild(document.createTextNode(u?"]":"}")),d}function*L(e){for(const[t,n]of e)yield F(t,n);yield*I(e)}function*P(e){for(const t of e)yield ie(t,!0);yield*I(e)}function*M(e){for(const t of e)yield ie(t,!0)}function*R(e){let t=-1,n=0;for(const r=e.size;n<r;++n)n>t+1&&(yield B(n-t-1)),yield ie(e.get(n),!0),t=n;n>t+1&&(yield B(n-t-1))}function*U(e){let t=-1,r=0;for(const n=e.length;r<n;++r)r in e&&(r>t+1&&(yield B(r-t-1)),yield ie(p(e,r),!0),t=r);r>t+1&&(yield B(r-t-1));for(const t in e)!n(t)&&d(e,t)&&(yield z(t,p(e,t),"observablehq--key"));for(const t of u(e))yield z(i(t),p(e,t),"observablehq--symbol")}function*I(e){for(const t in e)d(e,t)&&(yield z(t,p(e,t),"observablehq--key"));for(const t of u(e))yield z(i(t),p(e,t),"observablehq--symbol")}function*D(e){for(const[t,n]of e)yield z(t,n,"observablehq--key")}function B(e){const t=document.createElement("span");return t.className="observablehq--empty",t.textContent=1===e?"empty":`empty × ${e}`,t}function z(e,t,n){const r=document.createDocumentFragment(),o=r.appendChild(document.createElement("span"));return o.className=n,o.textContent=e,r.appendChild(document.createTextNode(": ")),r.appendChild(ie(t,!0)),r}function F(e,t){const n=document.createDocumentFragment();return n.appendChild(ie(e,!0)),n.appendChild(document.createTextNode(" => ")),n.appendChild(ie(t,!0)),n}function W(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return"function"==typeof t?t(e):t;const n=e.getUTCHours(),r=e.getUTCMinutes(),o=e.getUTCSeconds(),i=e.getUTCMilliseconds();return`${function(e){return e<0?`-${H(-e,6)}`:e>9999?`+${H(e,6)}`:H(e,4)}(e.getUTCFullYear())}-${H(e.getUTCMonth()+1,2)}-${H(e.getUTCDate(),2)}${n||r||o||i?`T${H(n,2)}:${H(r,2)}${o||i?`:${H(o,2)}${i?`.${H(i,3)}`:""}`:""}Z`:""}`}function H(e,t){return`${e}`.padStart(t,"0")}var V=Error.prototype.toString;var Y=RegExp.prototype.toString;function K(e){return e.replace(/[\\`\x00-\x09\x0b-\x19]|\${/g,J)}function J(e){var t=e.charCodeAt(0);switch(t){case 8:return"\\b";case 9:return"\\t";case 11:return"\\v";case 12:return"\\f";case 13:return"\\r"}return t<16?"\\x0"+t.toString(16):t<32?"\\x"+t.toString(16):"\\"+e}function Z(e,t){for(var n=0;t.exec(e);)++n;return n}var G=Function.prototype.toString,X={prefix:"async ƒ"},Q={prefix:"async ƒ*"},ee={prefix:"class"},te={prefix:"ƒ"},ne={prefix:"ƒ*"};function re(e,t,n){var o=document.createElement("span");o.className="observablehq--function",n&&o.appendChild(r(n));var i=o.appendChild(document.createElement("span"));return i.className="observablehq--keyword",i.textContent=e.prefix,o.appendChild(document.createTextNode(t)),o}const{prototype:{toString:oe}}=Object;function ie(e,t,n,o,a){let s=typeof e;switch(s){case"boolean":case"undefined":e+="";break;case"number":e=0===e&&1/e<0?"-0":e+"";break;case"bigint":e+="n";break;case"symbol":e=i(e);break;case"function":return function(e,t){var n,r,o=G.call(e);switch(e.constructor&&e.constructor.name){case"AsyncFunction":n=X;break;case"AsyncGeneratorFunction":n=Q;break;case"GeneratorFunction":n=ne;break;default:n=/^class\b/.test(o)?ee:te}return n===ee?re(n,"",t):(r=/^(?:async\s*)?(\w+)\s*=>/.exec(o))?re(n,"("+r[1]+")",t):(r=/^(?:async\s*)?\(\s*(\w+(?:\s*,\s*\w+)*)?\s*\)/.exec(o))||(r=/^(?:async\s*)?function(?:\s*\*)?(?:\s*\w+)?\s*\(\s*(\w+(?:\s*,\s*\w+)*)?\s*\)/.exec(o))?re(n,r[1]?"("+r[1].replace(/\s*,\s*/g,", ")+")":"()",t):re(n,"(…)",t)}(e,o);case"string":return function(e,t,n,o){if(!1===t){if(Z(e,/["\n]/g)<=Z(e,/`|\${/g)){const t=document.createElement("span");o&&t.appendChild(r(o));const n=t.appendChild(document.createElement("span"));return n.className="observablehq--string",n.textContent=JSON.stringify(e),t}const i=e.split("\n");if(i.length>20&&!n){const n=document.createElement("div");o&&n.appendChild(r(o));const a=n.appendChild(document.createElement("span"));a.className="observablehq--string",a.textContent="`"+K(i.slice(0,20).join("\n"));const s=n.appendChild(document.createElement("span")),c=i.length-20;return s.textContent=`Show ${c} truncated line${c>1?"s":""}`,s.className="observablehq--string-expand",s.addEventListener("mouseup",(function(r){r.stopPropagation(),ae(n,ie(e,t,!0,o))})),n}const a=document.createElement("span");o&&a.appendChild(r(o));const s=a.appendChild(document.createElement("span"));return s.className="observablehq--string"+(n?" observablehq--expanded":""),s.textContent="`"+K(e)+"`",a}const i=document.createElement("span");o&&i.appendChild(r(o));const a=i.appendChild(document.createElement("span"));return a.className="observablehq--string",a.textContent=JSON.stringify(e.length>100?`${e.slice(0,50)}…${e.slice(-49)}`:e),i}(e,t,n,o);default:if(null===e){s=null,e="null";break}if(e instanceof Date){s="date",e=function(e){return W(e,"Invalid Date")}(e);break}if(e===l){s="forbidden",e="[forbidden]";break}switch(oe.call(e)){case"[object RegExp]":s="regexp",e=function(e){return Y.call(e)}(e);break;case"[object Error]":case"[object DOMException]":s="error",e=function(e){return e.stack||V.call(e)}(e);break;default:return(n?w:$)(e,t,o,a)}}const c=document.createElement("span");o&&c.appendChild(r(o));const u=c.appendChild(document.createElement("span"));return u.className=`observablehq--${s}`,u.textContent=e,c}function ae(t,n){t.classList.contains("observablehq--inspect")&&n.classList.add("observablehq--inspect"),t.parentNode.replaceChild(n,t),e(n,"load")}const se=/\s+\(\d+:\d+\)$/m;class ce{constructor(e){if(!e)throw new Error("invalid node");this._node=e,e.classList.add("observablehq")}pending(){const{_node:e}=this;e.classList.remove("observablehq--error"),e.classList.add("observablehq--running")}fulfilled(t,n){const{_node:r}=this;if((!function(e){return(e instanceof Element||e instanceof Text)&&e instanceof e.constructor}(t)||t.parentNode&&t.parentNode!==r)&&(t=ie(t,!1,r.firstChild&&r.firstChild.classList&&r.firstChild.classList.contains("observablehq--expanded"),n)).classList.add("observablehq--inspect"),r.classList.remove("observablehq--running","observablehq--error"),r.firstChild!==t)if(r.firstChild){for(;r.lastChild!==r.firstChild;)r.removeChild(r.lastChild);r.replaceChild(t,r.firstChild)}else r.appendChild(t);e(r,"update")}rejected(t,n){const{_node:o}=this;for(o.classList.remove("observablehq--running"),o.classList.add("observablehq--error");o.lastChild;)o.removeChild(o.lastChild);var i=document.createElement("div");i.className="observablehq--inspect",n&&i.appendChild(r(n)),i.appendChild(document.createTextNode((t+"").replace(se,""))),o.appendChild(i),e(o,"error",{error:t})}}ce.into=function(e){if("string"==typeof e&&null==(e=document.querySelector(e)))throw new Error("container not found");return function(){return new ce(e.appendChild(document.createElement("div")))}};var le={},ue={};function de(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function fe(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function pe(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function he(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+pe(-e,6):e>9999?"+"+pe(e,6):pe(e,4)}(e.getUTCFullYear())+"-"+pe(e.getUTCMonth()+1,2)+"-"+pe(e.getUTCDate(),2)+(o?"T"+pe(t,2)+":"+pe(n,2)+":"+pe(r,2)+"."+pe(o,3)+"Z":r?"T"+pe(t,2)+":"+pe(n,2)+":"+pe(r,2)+"Z":n||t?"T"+pe(t,2)+":"+pe(n,2)+"Z":"")}function me(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,o=[],i=e.length,a=0,s=0,c=i<=0,l=!1;function u(){if(c)return ue;if(l)return l=!1,le;var t,r,o=a;if(34===e.charCodeAt(o)){for(;a++<i&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=i?c=!0:10===(r=e.charCodeAt(a++))?l=!0:13===r&&(l=!0,10===e.charCodeAt(a)&&++a),e.slice(o+1,t-1).replace(/""/g,'"')}for(;a<i;){if(10===(r=e.charCodeAt(t=a++)))l=!0;else if(13===r)l=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(o,t)}return c=!0,e.slice(o,i)}for(10===e.charCodeAt(i-1)&&--i,13===e.charCodeAt(i-1)&&--i;(r=u())!==ue;){for(var d=[];r!==le&&r!==ue;)d.push(r),r=u();t&&null==(d=t(d,s++))||o.push(d)}return o}function o(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function i(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?he(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,o,i=r(e,(function(e,r){if(n)return n(e,r-1);o=e,n=t?function(e,t){var n=de(e);return function(r,o){return t(n(r),o,e)}}(e,t):de(e)}));return i.columns=o||[],i},parseRows:r,format:function(t,n){return null==n&&(n=fe(t)),[n.map(a).join(e)].concat(o(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=fe(e)),o(e,t).join("\n")},formatRows:function(e){return e.map(i).join("\n")},formatRow:i,formatValue:a}}var be=me(","),ve=be.parse,ye=be.parseRows,we=be.format,_e=be.formatRows,ge=me("\t"),Ee=ge.parse,xe=ge.parseRows;function Ce(e){for(var t in e){var n,r,o=e[t].trim();if(o)if("true"===o)o=!0;else if("false"===o)o=!1;else if("NaN"===o)o=NaN;else if(isNaN(n=+o)){if(!(r=o.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;je&&r[4]&&!r[7]&&(o=o.replace(/-/g,"/").replace(/T/," ")),o=new Date(o)}else o=n;else o=null;e[t]=o}return e}const je=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours(),ke=new Map,Ne=[],Se=Ne.map,qe=Ne.some,Te=Ne.hasOwnProperty,Oe="https://cdn.jsdelivr.net/npm/",Ae=/^((?:@[^/@]+\/)?[^/@]+)(?:@([^/]+))?(?:\/(.*))?$/,$e=/^\d+\.\d+\.\d+(-[\w-.+]+)?$/,Le=/\.[^/]*$/,Pe=["unpkg","jsdelivr","browser","main"];class RequireError extends Error{constructor(e){super(e)}}function Me(e){const t=Ae.exec(e);return t&&{name:t[1],version:t[2],path:t[3]}}function Re(e){const t=`${Oe}${e.name}${e.version?`@${e.version}`:""}/package.json`;let n=ke.get(t);return n||ke.set(t,n=fetch(t).then((e=>{if(!e.ok)throw new RequireError("unable to load package.json");return e.redirected&&!ke.has(e.url)&&ke.set(e.url,n),e.json()}))),n}RequireError.prototype.name=RequireError.name;var Ue=Ie((async function(e,t){if(e.startsWith(Oe)&&(e=e.substring(Oe.length)),/^(\w+:)|\/\//i.test(e))return e;if(/^[.]{0,2}\//i.test(e))return new URL(e,null==t?location:t).href;if(!e.length||/^[\s._]/.test(e)||/\s$/.test(e))throw new RequireError("illegal name");const n=Me(e);if(!n)return`${Oe}${e}`;if(!n.version&&null!=t&&t.startsWith(Oe)){const e=await Re(Me(t.substring(Oe.length)));n.version=e.dependencies&&e.dependencies[n.name]||e.peerDependencies&&e.peerDependencies[n.name]}if(n.path&&!Le.test(n.path)&&(n.path+=".js"),n.path&&n.version&&$e.test(n.version))return`${Oe}${n.name}@${n.version}/${n.path}`;const r=await Re(n);return`${Oe}${r.name}@${r.version}/${n.path||function(e){for(const t of Pe){const n=e[t];if("string"==typeof n)return Le.test(n)?n:`${n}.js`}}(r)||"index.js"}`}));function Ie(e){const t=new Map,n=o(null);function r(e){if("string"!=typeof e)return e;let n=t.get(e);return n||t.set(e,n=new Promise(((t,n)=>{const r=document.createElement("script");r.onload=()=>{try{t(Ne.pop()(o(e)))}catch(e){n(new RequireError("invalid module"))}r.remove()},r.onerror=()=>{n(new RequireError("unable to load module")),r.remove()},r.async=!0,r.src=e,window.define=Fe,document.head.appendChild(r)}))),n}function o(t){return n=>Promise.resolve(e(n,t)).then(r)}function i(e){return arguments.length>1?Promise.all(Se.call(arguments,n)).then(De):n(e)}return i.alias=function(t){return Ie(((n,r)=>n in t&&(r=null,"string"!=typeof(n=t[n]))?n:e(n,r)))},i.resolve=e,i}function De(e){const t={};for(const n of e)for(const e in n)Te.call(n,e)&&(null==n[e]?Object.defineProperty(t,e,{get:Be(n,e)}):t[e]=n[e]);return t}function Be(e,t){return()=>e[t]}function ze(e){return"exports"===(e+="")||"module"===e}function Fe(e,t,n){const r=arguments.length;r<2?(n=e,t=[]):r<3&&(n=t,t="string"==typeof e?[]:e),Ne.push(qe.call(t,ze)?e=>{const r={},o={exports:r};return Promise.all(Se.call(t,(t=>"exports"===(t+="")?r:"module"===t?o:e(t)))).then((e=>(n.apply(null,e),o.exports)))}:e=>Promise.all(Se.call(t,e)).then((e=>"function"==typeof n?n.apply(null,e):n)))}function We(e,t,n){return{resolve:(r=n)=>`https://cdn.jsdelivr.net/npm/${e}@${t}/${r}`}}Fe.amd={};const He=We("d3","7.4.4","dist/d3.min.js"),Ve=We("@observablehq/inputs","0.10.4","dist/inputs.min.js"),Ye=We("@observablehq/plot","0.4.3","dist/plot.umd.min.js"),Ke=We("@observablehq/graphviz","0.2.1","dist/graphviz.min.js"),Je=We("@observablehq/highlight.js","2.0.0","highlight.min.js"),Ze=We("@observablehq/katex","0.11.1","dist/katex.min.js"),Ge=We("lodash","4.17.21","lodash.min.js"),Xe=We("htl","0.3.1","dist/htl.min.js"),Qe=We("jszip","3.9.1","dist/jszip.min.js"),et=We("marked","0.3.12","marked.min.js"),tt=We("sql.js","1.6.2","dist/sql-wasm.js"),nt=We("vega","5.22.1","build/vega.min.js"),rt=We("vega-lite","5.2.0","build/vega-lite.min.js"),ot=We("vega-lite-api","5.0.0","build/vega-lite-api.min.js"),it=We("apache-arrow","4.0.1","Arrow.es2015.min.js"),at=We("arquero","4.8.8","dist/arquero.min.js"),st=We("topojson-client","3.1.0","dist/topojson-client.min.js"),ct=We("exceljs","4.3.0","dist/exceljs.min.js"),lt=We("mermaid","9.0.0","dist/mermaid.min.js"),ut=We("leaflet","1.8.0","dist/leaflet.js");async function dt(e){return(await e(tt.resolve()))({locateFile:e=>tt.resolve(`dist/${e}`)})}class SQLiteDatabaseClient{constructor(e){Object.defineProperties(this,{_db:{value:e}})}static async open(e){const[t,n]=await Promise.all([dt(Ue),Promise.resolve(e).then(ft)]);return new SQLiteDatabaseClient(new t.Database(n))}async query(e,t){return await async function(e,t,n){const[r]=await e.exec(t,n);if(!r)return[];const{columns:o,values:i}=r,a=i.map((e=>Object.fromEntries(e.map(((e,t)=>[o[t],e])))));return a.columns=o,a}(this._db,e,t)}async queryRow(e,t){return(await this.query(e,t))[0]||null}async explain(e,t){return pt("pre",{className:"observablehq--inspect"},[ht((await this.query(`EXPLAIN QUERY PLAN ${e}`,t)).map((e=>e.detail)).join("\n"))])}async describe(e){const t=await(void 0===e?this.query("SELECT name FROM sqlite_master WHERE type = 'table'"):this.query("SELECT * FROM pragma_table_info(?)",[e]));if(!t.length)throw new Error("Not found");const{columns:n}=t;return pt("table",{value:t},[pt("thead",[pt("tr",n.map((e=>pt("th",[ht(e)]))))]),pt("tbody",t.map((e=>pt("tr",n.map((t=>pt("td",[ht(e[t])])))))))])}async sql(e,...t){return this.query(e.join("?"),t)}}function ft(e){return"string"==typeof e?fetch(e).then(ft):e instanceof Response||e instanceof Blob?e.arrayBuffer().then(ft):e instanceof ArrayBuffer?new Uint8Array(e):e}function pt(e,t,n){2===arguments.length&&(n=t,t=void 0);const r=document.createElement(e);if(void 0!==t)for(const e in t)r[e]=t[e];if(void 0!==n)for(const e of n)r.appendChild(e);return r}function ht(e){return document.createTextNode(e)}Object.defineProperty(SQLiteDatabaseClient.prototype,"dialect",{value:"sqlite"});class Workbook{constructor(e){Object.defineProperties(this,{_:{value:e},sheetNames:{value:e.worksheets.map((e=>e.name)),enumerable:!0}})}sheet(e,t){const n="number"==typeof e?this.sheetNames[e]:this.sheetNames.includes(e+="")?e:null;if(null==n)throw new Error(`Sheet not found: ${e}`);return function(e,{range:t,headers:n}={}){let[[r,o],[i,a]]=function(e=":",{columnCount:t,rowCount:n}){if(!(e+="").match(/^[A-Z]*\d*:[A-Z]*\d*$/))throw new Error("Malformed range specifier");const[[r=0,o=0],[i=t-1,a=n-1]]=e.split(":").map(yt);return[[r,o],[i,a]]}(t,e);const s=n?e._rows[o++]:null;let c=new Set(["#"]);for(let e=r;e<=i;e++){const t=s?mt(s.findCell(e+1)):null;let n=t&&t+""||vt(e);for(;c.has(n);)n+="_";c.add(n)}c=new Array(r).concat(Array.from(c));const l=new Array(a-o+1);for(let t=o;t<=a;t++){const n=l[t-o]=Object.create(null,{"#":{value:t+1}}),a=e.getRow(t+1);if(a.hasValues)for(let e=r;e<=i;e++){const t=mt(a.findCell(e+1));null!=t&&(n[c[e+1]]=t)}}return l.columns=c.filter((()=>!0)),l}(this._.getWorksheet(n),t)}}function mt(e){if(!e)return;const{value:t}=e;if(t&&"object"==typeof t&&!(t instanceof Date)){if(t.formula||t.sharedFormula)return t.result&&t.result.error?NaN:t.result;if(t.richText)return bt(t);if(t.text){let{text:e}=t;return e.richText&&(e=bt(e)),t.hyperlink&&t.hyperlink!==e?`${t.hyperlink} ${e}`:e}return t}return t}function bt(e){return e.richText.map((e=>e.text)).join("")}function vt(e){let t="";e++;do{t=String.fromCharCode(64+(e%26||26))+t}while(e=Math.floor((e-1)/26));return t}function yt(e){const[,t,n]=e.match(/^([A-Z]*)(\d*)$/);let r=0;if(t)for(let e=0;e<t.length;e++)r+=Math.pow(26,t.length-e-1)*(t.charCodeAt(e)-64);return[r?r-1:void 0,n?+n-1:void 0]}async function wt(e){const t=await fetch(await e.url());if(!t.ok)throw new Error(`Unable to load file: ${e.name}`);return t}async function _t(e,t,{array:n=!1,typed:r=!1}={}){const o=await e.text();return("\t"===t?n?xe:Ee:n?ye:ve)(o,r&&Ce)}class gt{constructor(e,t){Object.defineProperty(this,"name",{value:e,enumerable:!0}),void 0!==t&&Object.defineProperty(this,"mimeType",{value:t+"",enumerable:!0})}async blob(){return(await wt(this)).blob()}async arrayBuffer(){return(await wt(this)).arrayBuffer()}async text(){return(await wt(this)).text()}async json(){return(await wt(this)).json()}async stream(){return(await wt(this)).body}async csv(e){return _t(this,",",e)}async tsv(e){return _t(this,"\t",e)}async image(e){const t=await this.url();return new Promise(((n,r)=>{const o=new Image;new URL(t,document.baseURI).origin!==new URL(location).origin&&(o.crossOrigin="anonymous"),Object.assign(o,e),o.onload=()=>n(o),o.onerror=()=>r(new Error(`Unable to load file: ${this.name}`)),o.src=t}))}async arrow(){const[e,t]=await Promise.all([Ue(it.resolve()),wt(this)]);return e.Table.from(t)}async sqlite(){return SQLiteDatabaseClient.open(wt(this))}async zip(){const[e,t]=await Promise.all([Ue(Qe.resolve()),this.arrayBuffer()]);return new ZipArchive(await e.loadAsync(t))}async xml(e="application/xml"){return(new DOMParser).parseFromString(await this.text(),e)}async html(){return this.xml("text/html")}async xlsx(){const[e,t]=await Promise.all([Ue(ct.resolve()),this.arrayBuffer()]);return new Workbook(await(new e.Workbook).xlsx.load(t))}}class FileAttachment extends gt{constructor(e,t,n){super(t,n),Object.defineProperty(this,"_url",{value:e})}async url(){return await this._url+""}}function Et(e){throw new Error(`File not found: ${e}`)}class ZipArchive{constructor(e){Object.defineProperty(this,"_",{value:e}),this.filenames=Object.keys(e.files).filter((t=>!e.files[t].dir))}file(e){const t=this._.file(e+="");if(!t||t.dir)throw new Error(`file not found: ${e}`);return new ZipArchiveEntry(t)}}class ZipArchiveEntry extends gt{constructor(e){super(e.name),Object.defineProperty(this,"_",{value:e}),Object.defineProperty(this,"_url",{writable:!0})}async url(){return this._url||(this._url=this.blob().then(URL.createObjectURL))}async blob(){return this._.async("blob")}async arrayBuffer(){return this._.async("arraybuffer")}async text(){return this._.async("text")}async json(){return JSON.parse(await this.text())}}var xt={math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var Ct=0;function jt(e){return new kt("O-"+(null==e?"":e+"-")+ ++Ct)}function kt(e){this.id=e,this.href=new URL(`#${e}`,location)+""}kt.prototype.toString=function(){return"url("+this.href+")"};var Nt={canvas:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},context2d:function(e,t,n){null==n&&(n=devicePixelRatio);var r=document.createElement("canvas");r.width=e*n,r.height=t*n,r.style.width=e+"px";var o=r.getContext("2d");return o.scale(n,n),o},download:function(e,t="untitled",n="Save"){const r=document.createElement("a"),o=r.appendChild(document.createElement("button"));async function i(){await new Promise(requestAnimationFrame),URL.revokeObjectURL(r.href),r.removeAttribute("href"),o.textContent=n,o.disabled=!1}return o.textContent=n,r.download=t,r.onclick=async t=>{if(o.disabled=!0,r.href)return i();o.textContent="Saving…";try{const t=await("function"==typeof e?e():e);o.textContent="Download",r.href=URL.createObjectURL(t)}catch(e){o.textContent=n}if(t.eventPhase)return i();o.disabled=!1},r},element:function(e,t){var n,r=e+="",o=r.indexOf(":");o>=0&&"xmlns"!==(r=e.slice(0,o))&&(e=e.slice(o+1));var i=xt.hasOwnProperty(r)?document.createElementNS(xt[r],e):document.createElement(e);if(t)for(var a in t)o=(r=a).indexOf(":"),n=t[a],o>=0&&"xmlns"!==(r=a.slice(0,o))&&(a=a.slice(o+1)),xt.hasOwnProperty(r)?i.setAttributeNS(xt[r],a,n):i.setAttribute(a,n);return i},input:function(e){var t=document.createElement("input");return null!=e&&(t.type=e),t},range:function(e,t,n){1===arguments.length&&(t=e,e=null);var r=document.createElement("input");return r.min=e=null==e?0:+e,r.max=t=null==t?1:+t,r.step=null==n?"any":n=+n,r.type="range",r},select:function(e){var t=document.createElement("select");return Array.prototype.forEach.call(e,(function(e){var n=document.createElement("option");n.value=n.textContent=e,t.appendChild(n)})),t},svg:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("viewBox",[0,0,e,t]),n.setAttribute("width",e),n.setAttribute("height",t),n},text:function(e){return document.createTextNode(e)},uid:jt};var St={buffer:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsArrayBuffer(e)}))},text:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsText(e)}))},url:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsDataURL(e)}))}};function qt(){return this}function Tt(e,t){let n=!1;if("function"!=typeof t)throw new Error("dispose is not a function");return{[Symbol.iterator]:qt,next:()=>n?{done:!0}:(n=!0,{done:!1,value:e}),return:()=>(n=!0,t(e),{done:!0}),throw:()=>({done:n=!0})}}function Ot(e){let t,n,r=!1;const o=e((function(e){n?(n(e),n=null):r=!0;return t=e}));if(null!=o&&"function"!=typeof o)throw new Error("function"==typeof o.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:qt,throw:()=>({done:!0}),return:()=>(null!=o&&o(),{done:!0}),next:function(){return{done:!1,value:r?(r=!1,Promise.resolve(t)):new Promise((e=>n=e))}}}}function At(e){switch(e.type){case"range":case"number":return e.valueAsNumber;case"date":return e.valueAsDate;case"checkbox":return e.checked;case"file":return e.multiple?e.files:e.files[0];case"select-multiple":return Array.from(e.selectedOptions,(e=>e.value));default:return e.value}}var $t={disposable:Tt,filter:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)t(n.value,++r)&&(yield n.value)},input:function(e){return Ot((function(t){var n=function(e){switch(e.type){case"button":case"submit":case"checkbox":return"click";case"file":return"change";default:return"input"}}(e),r=At(e);function o(){t(At(e))}return e.addEventListener(n,o),void 0!==r&&t(r),function(){e.removeEventListener(n,o)}}))},map:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)yield t(n.value,++r)},observe:Ot,queue:function(e){let t;const n=[],r=e((function(e){n.push(e),t&&(t(n.shift()),t=null);return e}));if(null!=r&&"function"!=typeof r)throw new Error("function"==typeof r.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:qt,throw:()=>({done:!0}),return:()=>(null!=r&&r(),{done:!0}),next:function(){return{done:!1,value:n.length?Promise.resolve(n.shift()):new Promise((e=>t=e))}}}},range:function*(e,t,n){e=+e,t=+t,n=(o=arguments.length)<2?(t=e,e=0,1):o<3?1:+n;for(var r=-1,o=0|Math.max(0,Math.ceil((t-e)/n));++r<o;)yield e+r*n},valueAt:function(e,t){if(!(!isFinite(t=+t)||t<0||t!=t|0))for(var n,r=-1;!(n=e.next()).done;)if(++r===t)return n.value},worker:function(e){const t=URL.createObjectURL(new Blob([e],{type:"text/javascript"})),n=new Worker(t);return Tt(n,(()=>{n.terminate(),URL.revokeObjectURL(t)}))}};function Lt(e,t){return function(n){var r,o,i,a,s,c,l,u,d=n[0],f=[],p=null,h=-1;for(s=1,c=arguments.length;s<c;++s){if((r=arguments[s])instanceof Node)f[++h]=r,d+="\x3c!--o:"+h+"--\x3e";else if(Array.isArray(r)){for(l=0,u=r.length;l<u;++l)(o=r[l])instanceof Node?(null===p&&(f[++h]=p=document.createDocumentFragment(),d+="\x3c!--o:"+h+"--\x3e"),p.appendChild(o)):(p=null,d+=o);p=null}else d+=r;d+=n[s]}if(p=e(d),++h>0){for(i=new Array(h),a=document.createTreeWalker(p,NodeFilter.SHOW_COMMENT,null,!1);a.nextNode();)o=a.currentNode,/^o:/.test(o.nodeValue)&&(i[+o.nodeValue.slice(2)]=o);for(s=0;s<h;++s)(o=i[s])&&o.parentNode.replaceChild(f[s],o)}return 1===p.childNodes.length?p.removeChild(p.firstChild):11===p.nodeType?((o=t()).appendChild(p),o):p}}var Pt=Lt((function(e){var t=document.createElement("template");return t.innerHTML=e.trim(),document.importNode(t.content,!0)}),(function(){return document.createElement("span")}));function Mt(e){let t;Object.defineProperties(this,{generator:{value:Ot((e=>{t=e}))},value:{get:()=>e,set:n=>t(e=n)}}),void 0!==e&&t(e)}function*Rt(){for(;;)yield Date.now()}var Ut=new Map;function It(e,t){var n;return(n=Ut.get(e=+e))?n.then((()=>t)):(n=Date.now())>=e?Promise.resolve(t):function(e,t){var n=new Promise((function(n){Ut.delete(t);var r=t-e;if(!(r>0))throw new Error("invalid time");if(r>2147483647)throw new Error("too long to wait");setTimeout(n,r)}));return Ut.set(t,n),n}(n,e).then((()=>t))}var Dt={delay:function(e,t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))},tick:function(e,t){return It(Math.ceil((Date.now()+1)/e)*e,t)},when:It};function Bt(e,t){if(/^(\w+:)|\/\//i.test(e))return e;if(/^[.]{0,2}\//i.test(e))return new URL(e,null==t?location:t).href;if(!e.length||/^[\s._]/.test(e)||/\s$/.test(e))throw new Error("illegal name");return"https://unpkg.com/"+e}function zt(e){return null==e?Ue:Ie(e)}var Ft=Lt((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.innerHTML=e.trim(),t}),(function(){return document.createElementNS("http://www.w3.org/2000/svg","g")})),Wt=String.raw;function Ht(e){return new Promise((function(t,n){var r=document.createElement("link");r.rel="stylesheet",r.href=e,r.onerror=n,r.onload=t,document.head.appendChild(r)}))}function Vt(){return Ot((function(e){var t=e(document.body.clientWidth);function n(){var n=document.body.clientWidth;n!==t&&e(t=n)}return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}))}var Yt=Object.assign((function(e){const t=zt(e);Object.defineProperties(this,function(e){return Object.fromEntries(Object.entries(e).map(Kt))}({FileAttachment:()=>Et,Mutable:()=>Mt,now:Rt,width:Vt,dot:()=>t(Ke.resolve()),htl:()=>t(Xe.resolve()),html:()=>Pt,md:()=>function(e){return e(et.resolve()).then((function(t){return Lt((function(n){var r=document.createElement("div");r.innerHTML=t(n,{langPrefix:""}).trim();var o=r.querySelectorAll("pre code[class]");return o.length>0&&e(Je.resolve()).then((function(t){o.forEach((function(n){function r(){t.highlightBlock(n),n.parentNode.classList.add("observablehq--md-pre")}t.getLanguage(n.className)?r():e(Je.resolve("async-languages/index.js")).then((r=>{if(r.has(n.className))return e(Je.resolve("async-languages/"+r.get(n.className))).then((e=>{t.registerLanguage(n.className,e)}))})).then(r,r)}))})),r}),(function(){return document.createElement("div")}))}))}(t),svg:()=>Ft,tex:()=>function(e){return Promise.all([e(Ze.resolve()),Ht(Ze.resolve("dist/katex.min.css"))]).then((function(e){var t=e[0],n=r();function r(e){return function(){var n=document.createElement("div");return t.render(Wt.apply(String,arguments),n,e),n.removeChild(n.firstChild)}}return n.options=r,n.block=r({displayMode:!0}),n}))}(t),_:()=>t(Ge.resolve()),aq:()=>t.alias({"apache-arrow":it.resolve()})(at.resolve()),Arrow:()=>t(it.resolve()),d3:()=>t(He.resolve()),Inputs:()=>t(Ve.resolve()).then((e=>({...e,file:e.fileOf(gt)}))),L:()=>async function(e){const t=await e(ut.resolve());if(!t._style){const e=document.createElement("link");e.rel="stylesheet",e.href=ut.resolve("dist/leaflet.css"),t._style=document.head.appendChild(e)}return t}(t),mermaid:()=>async function(e){const t=await e(lt.resolve());return t.initialize({securityLevel:"loose",theme:"neutral"}),function(){const e=document.createElement("div");return e.innerHTML=t.render(jt().id,String.raw.apply(String,arguments)),e.removeChild(e.firstChild)}}(t),Plot:()=>t(Ye.resolve()),require:()=>t,resolve:()=>Bt,SQLite:()=>dt(t),SQLiteDatabaseClient:()=>SQLiteDatabaseClient,topojson:()=>t(st.resolve()),vl:()=>async function(e){const[t,n,r]=await Promise.all([nt,rt,ot].map((t=>e(t.resolve()))));return r.register(t,n)}(t),aapl:()=>new FileAttachment("https://static.observableusercontent.com/files/3ccff97fd2d93da734e76829b2b066eafdaac6a1fafdec0faf6ebc443271cfc109d29e80dd217468fcb2aff1e6bffdc73f356cc48feb657f35378e6abbbb63b9").csv({typed:!0}),alphabet:()=>new FileAttachment("https://static.observableusercontent.com/files/75d52e6c3130b1cae83cda89305e17b50f33e7420ef205587a135e8562bcfd22e483cf4fa2fb5df6dff66f9c5d19740be1cfaf47406286e2eb6574b49ffc685d").csv({typed:!0}),cars:()=>new FileAttachment("https://static.observableusercontent.com/files/048ec3dfd528110c0665dfa363dd28bc516ffb7247231f3ab25005036717f5c4c232a5efc7bb74bc03037155cb72b1abe85a33d86eb9f1a336196030443be4f6").csv({typed:!0}),citywages:()=>new FileAttachment("https://static.observableusercontent.com/files/39837ec5121fcc163131dbc2fe8c1a2e0b3423a5d1e96b5ce371e2ac2e20a290d78b71a4fb08b9fa6a0107776e17fb78af313b8ea70f4cc6648fad68ddf06f7a").csv({typed:!0}),diamonds:()=>new FileAttachment("https://static.observableusercontent.com/files/87942b1f5d061a21fa4bb8f2162db44e3ef0f7391301f867ab5ba718b225a63091af20675f0bfe7f922db097b217b377135203a7eab34651e21a8d09f4e37252").csv({typed:!0}),industries:()=>new FileAttachment("https://static.observableusercontent.com/files/76f13741128340cc88798c0a0b7fa5a2df8370f57554000774ab8ee9ae785ffa2903010cad670d4939af3e9c17e5e18e7e05ed2b38b848ac2fc1a0066aa0005f").csv({typed:!0}),olympians:()=>new FileAttachment("https://static.observableusercontent.com/files/31ca24545a0603dce099d10ee89ee5ae72d29fa55e8fc7c9ffb5ded87ac83060d80f1d9e21f4ae8eb04c1e8940b7287d179fe8060d887fb1f055f430e210007c").csv({typed:!0}),penguins:()=>new FileAttachment("https://static.observableusercontent.com/files/715db1223e067f00500780077febc6cebbdd90c151d3d78317c802732252052ab0e367039872ab9c77d6ef99e5f55a0724b35ddc898a1c99cb14c31a379af80a").csv({typed:!0}),weather:()=>new FileAttachment("https://static.observableusercontent.com/files/693a46b22b33db0f042728700e0c73e836fa13d55446df89120682d55339c6db7cc9e574d3d73f24ecc9bc7eb9ac9a1e7e104a1ee52c00aab1e77eb102913c1f").csv({typed:!0}),DOM:Nt,Files:St,Generators:$t,Promises:Dt}))}),{resolve:Ue.resolve});function Kt([e,t]){return[e,{value:t,writable:!0,enumerable:!0}]}function Jt(e,t){this.message=e+"",this.input=t}Jt.prototype=Object.create(Error.prototype),Jt.prototype.name="RuntimeError",Jt.prototype.constructor=Jt;var Zt=Array.prototype,Gt=Zt.map,Xt=Zt.forEach;function Qt(e){return function(){return e}}function en(e){return e}function tn(){}var nn={};function rn(e,t,n){n||(n=nn),Object.defineProperties(this,{_observer:{value:n,writable:!0},_definition:{value:sn,writable:!0},_duplicate:{value:void 0,writable:!0},_duplicates:{value:void 0,writable:!0},_indegree:{value:NaN,writable:!0},_inputs:{value:[],writable:!0},_invalidate:{value:tn,writable:!0},_module:{value:t},_name:{value:null,writable:!0},_outputs:{value:new Set,writable:!0},_promise:{value:Promise.resolve(void 0),writable:!0},_reachable:{value:n!==nn,writable:!0},_rejector:{value:cn(this)},_type:{value:e},_value:{value:void 0,writable:!0},_version:{value:0,writable:!0}})}function on(e){e._module._runtime._dirty.add(e),e._outputs.add(this)}function an(e){e._module._runtime._dirty.add(e),e._outputs.delete(this)}function sn(){throw sn}function cn(e){return function(t){if(t===sn)throw new Jt(e._name+" is not defined",e._name);if(t instanceof Error&&t.message)throw new Jt(t.message,e._name);throw new Jt(e._name+" could not be resolved",e._name)}}function ln(e){return function(){throw new Jt(e+" is defined more than once")}}function un(e,t,n){var r=this._module._scope,o=this._module._runtime;if(this._inputs.forEach(an,this),t.forEach(on,this),this._inputs=t,this._definition=n,this._value=void 0,n===tn?o._variables.delete(this):o._variables.add(this),e!==this._name||r.get(e)!==this){var i,a;if(this._name)if(this._outputs.size)r.delete(this._name),(a=this._module._resolve(this._name))._outputs=this._outputs,this._outputs=new Set,a._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(this)]=a}),this),a._outputs.forEach(o._updates.add,o._updates),o._dirty.add(a).add(this),r.set(this._name,a);else if((a=r.get(this._name))===this)r.delete(this._name);else{if(3!==a._type)throw new Error;a._duplicates.delete(this),this._duplicate=void 0,1===a._duplicates.size&&(a=a._duplicates.keys().next().value,i=r.get(this._name),a._outputs=i._outputs,i._outputs=new Set,a._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(i)]=a})),a._definition=a._duplicate,a._duplicate=void 0,o._dirty.add(i).add(a),o._updates.add(a),r.set(this._name,a))}if(this._outputs.size)throw new Error;e&&((a=r.get(e))?3===a._type?(this._definition=ln(e),this._duplicate=n,a._duplicates.add(this)):2===a._type?(this._outputs=a._outputs,a._outputs=new Set,this._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(a)]=this}),this),o._dirty.add(a).add(this),r.set(e,this)):(a._duplicate=a._definition,this._duplicate=n,(i=new rn(3,this._module))._name=e,i._definition=this._definition=a._definition=ln(e),i._outputs=a._outputs,a._outputs=new Set,i._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(a)]=i})),i._duplicates=new Set([this,a]),o._dirty.add(a).add(i),o._updates.add(a).add(i),r.set(e,i)):r.set(e,this)),this._name=e}return o._updates.add(this),o._compute(),this}function dn(e,t=[]){Object.defineProperties(this,{_runtime:{value:e},_scope:{value:new Map},_builtins:{value:new Map([["invalidation",hn],["visibility",mn],...t])},_source:{value:null,writable:!0}})}function fn(e){return e._name}Object.defineProperties(rn.prototype,{_pending:{value:function(){this._observer.pending&&this._observer.pending()},writable:!0,configurable:!0},_fulfilled:{value:function(e){this._observer.fulfilled&&this._observer.fulfilled(e,this._name)},writable:!0,configurable:!0},_rejected:{value:function(e){this._observer.rejected&&this._observer.rejected(e,this._name)},writable:!0,configurable:!0},define:{value:function(e,t,n){switch(arguments.length){case 1:n=e,e=t=null;break;case 2:n=t,"string"==typeof e?t=null:(t=e,e=null)}return un.call(this,null==e?null:e+"",null==t?[]:Gt.call(t,this._module._resolve,this._module),"function"==typeof n?n:Qt(n))},writable:!0,configurable:!0},delete:{value:function(){return un.call(this,null,[],tn)},writable:!0,configurable:!0},import:{value:function(e,t,n){arguments.length<3&&(n=t,t=e);return un.call(this,t+"",[n._resolve(e+"")],en)},writable:!0,configurable:!0}}),Object.defineProperties(dn.prototype,{_copy:{value:function(e,t){e._source=this,t.set(this,e);for(const[i,a]of this._scope){var n=e._scope.get(i);if(!n||1!==n._type)if(a._definition===en){var r=a._inputs[0],o=r._module;e.import(r._name,i,t.get(o)||(o._source?o._copy(new dn(e._runtime,e._builtins),t):o))}else e.define(i,a._inputs.map(fn),a._definition)}return e},writable:!0,configurable:!0},_resolve:{value:function(e){var t,n=this._scope.get(e);if(!n)if(n=new rn(2,this),this._builtins.has(e))n.define(e,Qt(this._builtins.get(e)));else if(this._runtime._builtin._scope.has(e))n.import(e,this._runtime._builtin);else{try{t=this._runtime._global(e)}catch(t){return n.define(e,function(e){return function(){throw e}}(t))}void 0===t?this._scope.set(n._name=e,n):n.define(e,Qt(t))}return n},writable:!0,configurable:!0},redefine:{value:function(e){var t=this._scope.get(e);if(!t)throw new Jt(e+" is not defined");if(3===t._type)throw new Jt(e+" is defined more than once");return t.define.apply(t,arguments)},writable:!0,configurable:!0},define:{value:function(){var e=new rn(1,this);return e.define.apply(e,arguments)},writable:!0,configurable:!0},derive:{value:function(e,t){var n=new dn(this._runtime,this._builtins);return n._source=this,Xt.call(e,(function(e){"object"!=typeof e&&(e={name:e+""}),null==e.alias&&(e.alias=e.name),n.import(e.name,e.alias,t)})),Promise.resolve().then((()=>{const e=new Set([this]);for(const t of e)for(const n of t._scope.values())if(n._definition===en){const t=n._inputs[0]._module,r=t._source||t;if(r===this)return void console.warn("circular module definition; ignoring");e.add(r)}this._copy(n,new Map)})),n},writable:!0,configurable:!0},import:{value:function(){var e=new rn(1,this);return e.import.apply(e,arguments)},writable:!0,configurable:!0},value:{value:async function(e){var t=this._scope.get(e);if(!t)throw new Jt(e+" is not defined");t._observer===nn&&(t._observer=!0,this._runtime._dirty.add(t));return await this._runtime._compute(),t._promise},writable:!0,configurable:!0},variable:{value:function(e){return new rn(1,this,e)},writable:!0,configurable:!0},builtin:{value:function(e,t){this._builtins.set(e,t)},writable:!0,configurable:!0}});const pn="function"==typeof requestAnimationFrame?requestAnimationFrame:"function"==typeof setImmediate?setImmediate:e=>setTimeout(e,0);var hn={},mn={};function bn(e=new Yt,t=jn){var n=this.module();if(Object.defineProperties(this,{_dirty:{value:new Set},_updates:{value:new Set},_precomputes:{value:[],writable:!0},_computing:{value:null,writable:!0},_init:{value:null,writable:!0},_modules:{value:new Map},_variables:{value:new Set},_disposed:{value:!1,writable:!0},_builtin:{value:n},_global:{value:t}}),e)for(var r in e)new rn(2,n).define(r,[],e[r])}function vn(e){const t=new Set(e._inputs);for(const n of t){if(n===e)return!0;n._inputs.forEach(t.add,t)}return!1}function yn(e){++e._indegree}function wn(e){--e._indegree}function _n(e){return e._promise.catch(e._rejector)}function gn(e){return new Promise((function(t){e._invalidate=t}))}function En(e,t){let n,r,o="function"==typeof IntersectionObserver&&t._observer&&t._observer._node,i=!o,a=tn,s=tn;return o&&(r=new IntersectionObserver((([e])=>(i=e.isIntersecting)&&(n=null,a()))),r.observe(o),e.then((()=>(r.disconnect(),r=null,s())))),function(e){return i?Promise.resolve(e):r?(n||(n=new Promise(((e,t)=>(a=e,s=t)))),n.then((()=>e))):Promise.reject()}}function xn(e){e._invalidate(),e._invalidate=tn,e._pending();const t=e._value,n=++e._version;let r=null;const o=e._promise=(e._inputs.length?Promise.all(e._inputs.map(_n)).then((function(o){if(e._version!==n)return;for(var i=0,a=o.length;i<a;++i)switch(o[i]){case hn:o[i]=r=gn(e);break;case mn:r||(r=gn(e)),o[i]=En(r,e)}return e._definition.apply(t,o)})):new Promise((n=>n(e._definition.call(t))))).then((function(t){if(function(e){return e&&"function"==typeof e.next&&"function"==typeof e.return}(t))return e._version!==n?void t.return():((r||gn(e)).then(function(e){return function(){e.return()}}(t)),function(e,t,n){const r=e._module._runtime;let o;function i(e){return new Promise((e=>e(n.next(o)))).then((({done:t,value:n})=>t?void 0:Promise.resolve(n).then(e)))}function a(){const n=i((i=>{if(e._version===t)return o=i,s(i,n).then((()=>r._precompute(a))),e._fulfilled(i),i}));n.catch((r=>{e._version===t&&(s(void 0,n),e._rejected(r))}))}function s(t,n){return e._value=t,e._promise=n,e._outputs.forEach(r._updates.add,r._updates),r._compute()}return i((n=>{if(e._version===t)return o=n,r._precompute(a),n}))}(e,n,t));return t}));o.then((t=>{e._version===n&&(e._value=t,e._fulfilled(t))}),(t=>{e._version===n&&(e._value=void 0,e._rejected(t))}))}function Cn(e,t){e._invalidate(),e._invalidate=tn,e._pending(),++e._version,e._indegree=NaN,(e._promise=Promise.reject(t)).catch(tn),e._value=void 0,e._rejected(t)}function jn(e){return window[e]}Object.defineProperties(bn,{load:{value:function(e,t,n){if("function"==typeof t&&(n=t,t=null),"function"!=typeof n)throw new Error("invalid observer");null==t&&(t=new Yt);const{modules:r,id:o}=e,i=new Map,a=new bn(t),s=c(o);function c(e){let t=i.get(e);return t||i.set(e,t=a.module()),t}for(const e of r){const t=c(e.id);let r=0;for(const o of e.variables)o.from?t.import(o.remote,o.name,c(o.from)):t===s?t.variable(n(o,r,e.variables)).define(o.name,o.inputs,o.value):t.define(o.name,o.inputs,o.value),++r}return a},writable:!0,configurable:!0}}),Object.defineProperties(bn.prototype,{_precompute:{value:function(e){this._precomputes.push(e),this._compute()},writable:!0,configurable:!0},_compute:{value:function(){return this._computing||(this._computing=this._computeSoon())},writable:!0,configurable:!0},_computeSoon:{value:function(){return new Promise(pn).then((()=>this._disposed?void 0:this._computeNow()))},writable:!0,configurable:!0},_computeNow:{value:async function(){var e,t,n=[],r=this._precomputes;if(r.length){this._precomputes=[];for(const e of r)e();await function(e=0){let t=Promise.resolve();for(let n=0;n<e;++n)t=t.then((()=>{}));return t}(3)}(e=new Set(this._dirty)).forEach((function(t){t._inputs.forEach(e.add,e);const n=function(e){if(e._observer!==nn)return!0;var t=new Set(e._outputs);for(const e of t){if(e._observer!==nn)return!0;e._outputs.forEach(t.add,t)}return!1}(t);n>t._reachable?this._updates.add(t):n<t._reachable&&t._invalidate(),t._reachable=n}),this),(e=new Set(this._updates)).forEach((function(t){t._reachable?(t._indegree=0,t._outputs.forEach(e.add,e)):(t._indegree=NaN,e.delete(t))})),this._computing=null,this._updates.clear(),this._dirty.clear(),e.forEach((function(e){e._outputs.forEach(yn)}));do{for(e.forEach((function(e){0===e._indegree&&n.push(e)}));t=n.pop();)xn(t),t._outputs.forEach(o),e.delete(t);e.forEach((function(t){vn(t)&&(Cn(t,new Jt("circular definition")),t._outputs.forEach(wn),e.delete(t))}))}while(e.size);function o(e){0==--e._indegree&&n.push(e)}},writable:!0,configurable:!0},dispose:{value:function(){this._computing=Promise.resolve(),this._disposed=!0,this._variables.forEach((e=>{e._invalidate(),e._version=NaN}))},writable:!0,configurable:!0},module:{value:function(e,t=tn){let n;if(void 0===e)return(n=this._init)?(this._init=null,n):new dn(this);if(n=this._modules.get(e),n)return n;this._init=n=new dn(this),this._modules.set(e,n);try{e(this,t)}finally{this._init=null}return n},writable:!0,configurable:!0},fileAttachments:{value:function(e){return Object.assign((t=>{const n=e(t+="");if(null==n)throw new Error(`File not found: ${t}`);if("object"==typeof n&&"url"in n){const{url:e,mimeType:r}=n;return new FileAttachment(e,t,r)}return new FileAttachment(n,t)}),{prototype:FileAttachment.prototype})},writable:!0,configurable:!0}});function kn(e,t){try{return(0,eval)(`"use strict";(\n${e}\n)\n//# sourceURL=observablehq-${t}`)}catch(e){return function(e){return()=>{throw e}}(e)}}const Nn=new Map;let Sn;let qn;let Tn,On;function An(e){return"sql"===e||"table"===e}class $n extends ce{constructor(e,t){const n=document.createElement("DIV");super(n),n.setAttribute("dir","auto"),n.addEventListener("mouseenter",(()=>{io({type:"hover",node_id:this.id})})),this.id=e,this.node=n,this.mode=t,this.fileAttachments=new Set,this._variable=Nr.variable(this),this._secondaries=[],this._offset=0,this._height=0,this._empty=void 0,this._generation=0,this._resized=()=>{this._resize(Math.max(0,this.node.nextSibling.offsetTop-this.node.offsetTop-this._offset-17))},this._resizer=new ResizeObserver(this._resized),this._resizer.observe(n),this._error=void 0}define(e){const{type:t,fileAttachments:n=new Set}=e,r=++this._generation;for(const e of this._secondaries)e.delete();switch(this._secondaries.length=0,this._empty=!1,this.fileAttachments=n,t){case"empty":this._empty=!0,this._variable.delete();break;case"import":{const{module:t,specifier:n,specifiers:o,injections:i}=e,a=async function(e,t){if("string"==typeof e)return import(e).catch((()=>{throw new TypeError(`Notebook '${t}' failed to load`)}));if(Nn.has(e))throw new Error("duplicate module identifier");return new Promise(((t,n)=>Nn.set(e,[t,n])))}(t,n).then((({default:e})=>{if(this._generation!==r)throw new Error("redefined");const t=kr.module(e);return i?t.derive(Array.from(Rn(i)),Nr):t}));for(const e of Rn(o)){const t=Nr.define(e.alias,a.then((async n=>{t.import(e.name,e.alias,n),await kr._computing,await t._promise})));this._secondaries.push(t)}this._variable.define(a.then((t=>function({specifier:e,specifiers:t,notebook:n},r){const o=document.createElement("span");o.className="observablehq--inspect observablehq--import",o.appendChild(document.createTextNode("import {"));let i=!1;for(const{imported:e,local:a}of t){const t=r._scope.get(e);i?o.appendChild(document.createTextNode(", ")):i=!0;const s=document.createElement("a");1!==t._type?s.className="observablehq--unknown":n&&(s.href=Un(new URL(`#${e}`,n))),s.textContent=e,o.appendChild(s),e!==a&&o.appendChild(document.createTextNode(` as ${a}`))}if(o.appendChild(document.createTextNode("}")),n){o.appendChild(document.createTextNode(" from "));const t=o.appendChild(document.createElement("a"));t.href=Un(new URL(n)),t.textContent=`"${e}"`}return o}(e,t))));break}case"viewof":{const{name:t,inputs:n,body:r}=e,o=`viewof ${t}`;this._variable.define(o,n,kn(r,this.id)),this._secondaries.push(Nr.define(t,["Generators",o],Ln));break}case"mutable":{const{name:t,inputs:n,body:r}=e,o=`initial ${t}`,i=`mutable ${t}`;this._secondaries.push(Nr.define(o,n,kn(r,this.id)),Nr.define(i,["Mutable",o],Pn)),this._variable.define(t,[i],Mn);break}default:{const{name:t,inputs:n,body:r}=e;this._variable.define(t,n,kn(r,this.id));break}}this.offset()}offset(e=this._offset){this._offset=e;const t=17+e;this.node.style.marginBottom=this._empty||An(this.mode)?`calc(${t}px - 1.5rem)`:`${t}px`,this._resized()}run(){kr._updates.add(this._variable),kr._compute()}async resolve(){await kr._computing,await this._variable._promise}value(){return this._variable._value}valueAsView(){const e=this._variable._value;return e instanceof EventTarget?e.value:void 0}fulfilled(e,t){const{classList:n}=this.node;An(this.mode)?(this._blank(t),Tn||(Tn=new Map),Tn.set(this.id,null===e?null:{results:e,schema:e?e.schema??e._schema:null}),setTimeout(Bn,50)):this._empty?this._blank(t):(super.fulfilled(e,t),n.add("observablehq--changed"),Sn||(setTimeout(In,150),Sn=new Set),Sn.add(n)),void 0!==this._error&&(this._error=void 0,qn||(setTimeout(Dn,50),qn=new Map),qn.set(this.id,null))}rejected(e,t){An(this.mode)?(this._blank(t),Tn||(Tn=new Map),Tn.set(this.id,{error:`${e.name}: ${e.message}`}),setTimeout(Bn,50)):(super.rejected(e,t),e&&(this._error=e,qn||(setTimeout(Dn,50),qn=new Map),qn.set(this.id,function({message:e,stack:t,input:n,name:r}){return{message:e,stack:t,input:n,name:r}}(e))))}pending(){An(this.mode)?(Tn||(Tn=new Map),Tn.set(this.id,{pending:!0}),setTimeout(Bn,50)):super.pending()}_blank(e){super.fulfilled(document.createTextNode(""),e)}_resize(e){this._height!==e&&(this._height=e,io({type:"resize",node_id:this.id,height:e}))}dispose(){this._resizer.disconnect(),this._resize(0);for(const e of this._secondaries)e.delete();this._secondaries.length=0,this._variable.delete(),this.fileAttachments=new Set,An(this.mode)&&(Tn||(Tn=new Map),Tn.set(this.id,null),setTimeout(Bn,50))}setMode(e){this.mode!==e&&(An(this.mode)&&(Tn||(Tn=new Map),Tn.set(this.id,null),setTimeout(Bn,50)),this.mode=e)}}function Ln(e,t){return e.input(t)}function Pn(e,t){return new e(t)}function Mn(e){return e.generator}function*Rn(e){for(const t of e)yield{name:t.imported,alias:t.local},t.view?yield{name:`viewof ${t.imported}`,alias:`viewof ${t.local}`}:t.mutable&&(yield{name:`mutable ${t.imported}`,alias:`mutable ${t.local}`})}function Un(e){const t="/msteams";return e.pathname.startsWith("/msteams/")&&(e.pathname=e.pathname.substr(t.length)),e}function In(){for(const e of Sn)e.remove("observablehq--changed");Sn=void 0}function Dn(){io({type:"errors",errors:qn}),qn=void 0}function Bn(){io({type:"database_results",databaseResults:Tn}),Tn=void 0}function zn({currentUser:e}){On&&On(e)}const Fn={number:[/^(small)int(\(|$)/,/^(small|big)?serial(\(|$)/,"integer","decimal","numeric","real","double precision"],string:[/^(var)?char(\(|$)/,"character","text","bigint"],boolean:["boolean"],date:["time","interval","date"],array:["array"]},Wn={number:[/^(tiny|small|medium)?int(\(|$)/,"integer","decimal","numeric","float","double"],string:[/^(var)?char(\(|$)/,/^(tiny|medium|long)?text(\(|$)/,"enum","bigint"],boolean:[/^bool(ean)?(\(|$)/],date:["date","time","year"]};function Hn(e,t){let n;switch(t){case"mysql":n=Object.entries(Wn);break;case"postgres":case"bigquery":case"snowflake":n=Object.entries(Fn);break;default:return"other"}e=e.toLowerCase();for(const[t,r]of n)for(const n of r)if(new RegExp(n).test(e))return t;return"other"}const Vn=new Map,Yn=new Map;async function Kn(e){if(!e)throw new Error("Database not found");const t=Yn.get(e);if(t){if(t.exp>=Date.now()+1e4)return t;Yn.delete(e)}const n=Vn.get(e);if(n)return n.promise;let r,o;const i=new Promise(((e,t)=>(r=e,o=t)));return Vn.set(e,{promise:i,resolve:r,reject:o}),io({type:"request_database_token",name:e}),i}function Jn(e,t){Yn.get(e)===t&&Yn.delete(e)}function DatabaseClient(e){if(void 0===new.target)return Kn(e+="").then((({type:t})=>{switch(t){case"bigquery":t=BigQueryDatabaseClient;break;case"mysql":t=MySQLDatabaseClient;break;case"postgres":t=PostgreSQLDatabaseClient;break;case"snowflake":t=Xn;break;default:throw new Error("Unsupported database type")}return new t(e)}));if(new.target===DatabaseClient)throw new TypeError("DatabaseClient is not a constructor");Object.defineProperties(this,{name:{value:e,enumerable:!0}})}Object.defineProperties(DatabaseClient.prototype,{query:{value:async function(e,t,{signal:n}={}){const r=await Kn(this.name),o=await fetch(`${r.origin}/query`,{method:"POST",headers:{Authorization:`Bearer ${r.token}`,"Content-Type":"application/json"},body:JSON.stringify({sql:e,params:t}),signal:n});if(!o.ok){if(401===o.status)throw Jn(this.name,r),new Error("Unauthorized: invalid or expired token. Try again?");const e=o.headers.get("content-type");throw new Error(e&&e.startsWith("application/json")?(await o.json()).message:await o.text())}const{data:i,schema:a}=await o.json();a&&(!function(e,t){nr(e)(t)}(a,i),Object.defineProperty(i,"_schema",{value:a,writable:!0}));return i},writable:!0,configurable:!0},queryStream:{value:async function(e,t,{signal:n}={}){const r=await Kn(this.name),o=await fetch(`${r.origin}/query-stream`,{method:"POST",headers:{Authorization:`Bearer ${r.token}`,"Content-Type":"application/json"},body:JSON.stringify({sql:e,params:t}),signal:n});if(!o.ok){if(401===o.status)throw Jn(this.name,r),new Error("Unauthorized: invalid or expired token. Try again?");const e=o.headers.get("content-type");throw new Error(e&&e.startsWith("application/json")?(await o.json()).message:await o.text())}const i=async function*(e){const t=e.body.getReader(),n=new TextDecoder("utf-8");let r="";for(;;){const{value:e,done:o}=await t.read();if(e){const t=(r+n.decode(e)).split("\n");r=t.pop(),yield t.filter(Boolean).map(JSON.parse)}if(o)break}}(o),{value:[a,...s]}=await i.next();return{schema:a,async*readRows(){const e=nr(a);s.length&&(yield e(s));for await(const t of i)yield e(t)}}},writable:!0,configurable:!0},queryTag:{value:function(e,...t){return[e.join("?"),t]},writable:!0,configurable:!0},queryRow:{value:async function(...e){return(await this.query(...e))[0]||null},writable:!0,configurable:!0},sql:{value:async function(){return this.query(...this.queryTag.apply(this,arguments))},writable:!0,configurable:!0}});class BigQueryDatabaseClient extends DatabaseClient{async queryStream(){const e=await this.query.apply(this,arguments);return{schema:e._schema,async*readRows(){yield e}}}}Object.defineProperty(BigQueryDatabaseClient.prototype,"dialect",{value:"bigquery"});class PostgreSQLDatabaseClient extends DatabaseClient{async describe(e){return rr(await Zn.call(this,e))}async explain(e,t,n){return function(e){const t=document.createElement("pre");return t.className="observablehq--inspect",t.appendChild(document.createTextNode(e)),t}((await this.query(`EXPLAIN ANALYZE ${e}`,t,n)).map((e=>e["QUERY PLAN"])).join("\n"))}async schema(e){const t=await Zn.call(this,e);return{type:"object",properties:Object.fromEntries(t.map(void 0===e?({table_name:e})=>[e,{type:"array",items:{type:"object"}}]:({column_name:e,data_type:t,element_type:n,is_nullable:r,privileges:o})=>{const i=t.toLowerCase(),a=Hn(t,this.dialect);return[e,{type:"YES"===r?[a,"null"]:a,..."array"===i?{items:{type:Hn(n,this.dialect)}}:null,...i!==a?{[i]:!0}:null,privileges:o}]}))}}queryTag(e,...t){return[e.reduce(((e,t,n)=>e+"$"+n+t)),t]}}async function Zn(e){return await(void 0===e?this.query("SELECT table_schema, table_name\nFROM information_schema.tables\nWHERE table_schema NOT IN ('pg_catalog', 'information_schema')\nORDER BY 1, 2"):this.query("SELECT c.column_name, c.data_type, e.data_type AS element_type, c.column_default, c.is_nullable,\n              ARRAY(SELECT p.privilege_type::text FROM information_schema.column_privileges p\n                    WHERE (p.table_name = c.table_name AND p.column_name = c.column_name)) AS privileges\nFROM information_schema.columns c\nLEFT JOIN information_schema.element_types e\n     ON ((c.table_catalog, c.table_schema, c.table_name, 'TABLE', c.dtd_identifier)\n       = (e.object_catalog, e.object_schema, e.object_name, e.object_type, e.collection_type_identifier))\nWHERE c.table_name = $1\nORDER BY c.ordinal_position",[e]))}Object.defineProperties(PostgreSQLDatabaseClient.prototype,{dialect:{value:"postgres",writable:!0,configurable:!0}});class MySQLDatabaseClient extends DatabaseClient{async describe(e){return rr(await Gn.call(this,e))}async schema(e){const t=await Gn.call(this,e);return{type:"object",properties:Object.fromEntries(t.map(void 0===e?e=>[Object.values(e)[0],{type:"array",items:{type:"object"}}]:({Field:e,Type:t,Null:n,Privileges:r})=>{const o=t.toLowerCase(),i=Hn(o,this.dialect);return[e,{type:"YES"===n?[i,"null"]:i,...o!==i?{[o]:!0}:null,privileges:r}]}))}}}async function Gn(e){return await this.query(void 0===e?"SHOW TABLES":`SHOW FULL COLUMNS FROM ${e}`)}Object.defineProperty(MySQLDatabaseClient.prototype,"dialect",{value:"mysql"});class Xn extends DatabaseClient{async describe(e){return rr(await this.query(void 0===e?"SHOW TABLES":`DESCRIBE TABLE ${e}`))}async schema(e){const t=await this.query(void 0===e?"SHOW TABLES":`DESCRIBE TABLE ${e}`);return{type:"object",properties:Object.fromEntries(t.map(void 0===e?({name:e})=>[e,{type:"array",items:{type:"object"}}]:({name:e,type:t,"null?":n})=>{const r=t.toLowerCase(),o=Hn(t,this.dialect);return[e,{type:"Y"===n?[o,"null"]:o,...r!==o?{[r]:!0}:null}]}))}}async explain(e,t){return rr(await this.query(`EXPLAIN ${e}`,t))}}function Qn(e){return Uint8Array.from(e.data).buffer}function er(e){return new Date(e)}function tr(e){return+e}function nr({items:{properties:e}}){const t=Object.entries(e).map((([e,{type:t,buffer:n,date:r}])=>n?[e,Qn]:r?[e,er]:t.includes("integer")||t.includes("number")?[e,tr]:void 0)).filter((e=>e));return e=>{for(const[n,r]of t)for(const t of e)null!==t[n]&&(t[n]=r(t[n]));return e}}function rr(e){if(!e.length)throw new Error("Not found");const t=document.createElement("table"),n=t.appendChild(document.createElement("thead")).appendChild(document.createElement("tr"));for(const t of Object.keys(e._schema.items.properties))n.appendChild(document.createElement("th")).appendChild(document.createTextNode(t));const r=t.appendChild(document.createElement("tbody"));for(const t of e){const e=r.appendChild(document.createElement("tr"));for(const n of Object.values(t))e.appendChild(document.createElement("td")).appendChild(document.createTextNode(n))}return t.value=e,t}Object.defineProperty(Xn.prototype,"dialect",{value:"snowflake"});const or=Object.assign((async(e,t,n)=>{const r=function(e){const{select:t,from:n,filter:r,sort:o,slice:i}=e;if(null===n.table||0===t.columns?.length)return;const a=[[`SELECT ${null===t.columns?"t.*":t.columns.map((e=>`t.${e}`))} FROM ${n.table} t`]];for(let e=0;e<r.length;++e)ar(e?"\nAND ":"\nWHERE ",a),cr(r[e],a);for(let e=0;e<o.length;++e)ar(e?", ":"\nORDER BY ",a),sr(o[e],a);null===i.to&&null===i.from||ar("\nLIMIT "+(null!==i.to?i.to-(i.from??0):1e9),a);null!==i.from&&ar(` OFFSET ${i.from}`,a);return a}(t);return r?ir(await e,r,n):[]}),{sql:(e,t)=>async function(){return ir(e,arguments,t)}});async function ir(e,t,n){if(e){if("function"==typeof e.queryTag){const r=new AbortController,o={signal:r.signal};if(n.then((()=>r.abort("invalidated"))),"function"==typeof e.queryStream)return async function*(e){const t=await e,n=[];n.done=!1,n.error=null,n.schema=t.schema;try{const e=t.readRows();do{const t=await e.next();if(t.done)n.done=!0;else for(const e of t.value)n.push(e);yield n}while(!n.done)}catch(e){n.error=e,yield n}}(e.queryStream(...e.queryTag.apply(e,t),o));if("function"==typeof e.query)return e.query(...e.queryTag.apply(e,t),o)}if("function"==typeof e.sql)return e.sql.apply(e,t);throw new Error("source does not implement query, queryStream, or sql")}}function ar(e,t){const n=t[0];n[n.length-1]+=e}function sr({column:e,direction:t},n){ar(`t.${e} ${t.toUpperCase()}`,n)}function cr({type:e,operands:t},n){if(t.length<1)throw new Error("Invalid operand length");if(1===t.length)switch(lr(t[0],n),e){case"n":return void ar(" IS NULL",n);case"nn":return void ar(" IS NOT NULL",n);default:throw new Error("Invalid filter operation")}if(2!==t.length||["in","nin"].includes(e)){switch(lr(t[0],n),e){case"in":ar(" IN (",n);break;case"nin":ar(" NOT IN (",n);break;default:throw new Error("Invalid filter operation")}!function(e,t){let n=!0;for(const r of e)n?n=!1:ar(",",t),t.push(r.value),t[0].push("")}(t.slice(1),n),ar(")",n)}else{if(["c","nc"].includes(e)){switch(lr(t[0],n),e){case"c":ar(" LIKE ",n);break;case"nc":ar(" NOT LIKE ",n)}return void lr(function(e){return{...e,value:`%${e.value}%`}}(t[1]),n)}switch(lr(t[0],n),e){case"eq":ar(" = ",n);break;case"ne":ar(" <> ",n);break;case"gt":ar(" > ",n);break;case"lt":ar(" < ",n);break;case"gte":ar(" >= ",n);break;case"lte":ar(" <= ",n);break;default:throw new Error("Invalid filter operation")}lr(t[1],n)}}function lr(e,t){"column"===e.type?ar(`t.${e.value}`,t):(t.push(e.value),t[0].push(""))}const ur=new Map,dr=new Map,fr=new Set,pr=new Map,hr=new Set;function mr({name:e,blob:t,url:n,cloud:r,mimeType:o}){if(ur.has(e))throw new Error("duplicate file");void 0!==t&&(n=URL.createObjectURL(t),fr.add(n)),vr(e,n),dr.set(e,o),r&&hr.add(e)}function br({name:e,url:t}){if(!ur.has(e))throw new Error("unknown file");vr(e,t)}function vr(e,t){if(ur.set(e,t),void 0!==t){const n=pr.get(e);n&&(n.resolve(t),pr.delete(e))}}function yr({name:e}){if(!ur.has(e))throw new Error("unknown file");const t=ur.get(e);fr.has(t)&&URL.revokeObjectURL(t),ur.delete(e),hr.delete(e),dr.delete(e);const n=pr.get(e);n&&(n.reject(new Error(`File not found: ${e}`)),pr.delete(e))}var wr=bn.prototype.fileAttachments((e=>{if(e+="",!ur.has(e))return;const t=ur.get(e),n=dr.get(e);if(void 0!==t)return{url:t,mimeType:n};let r;const o=pr.get(e);if(o)r=o.promise;else{let t,n;r=new Promise(((e,r)=>(t=e,n=r))),pr.set(e,{promise:r,resolve:t,reject:n}),hr.has(e)&&io({type:"request_cloud_file",name:e})}return{url:r,mimeType:n}}));let _r,gr;function Er(e){if(new.target===Er)throw new TypeError("Secret is not a constructor");if(void 0===_r)throw new Error("Secrets are only available in private notebooks");if(!_r.has(e+=""))throw new Error("Secret not found");return _r.get(e)}function xr({delay:e}){void 0===_r&&(_r=new Map);const t=kr._builtin._scope.get("Secret"),n=e?new Promise((e=>gr=e)):Promise.resolve(Er);t._promise=n,t._definition=()=>n,Nr._scope.delete("Secret")}const Cr=document.createElement("div");Cr.className="observablehq-root",document.body.appendChild(Cr);const jr=document.createElement("div");jr.className="observablehq-end",Cr.appendChild(jr);const kr=new bn(Object.assign(new Yt,{currentUser:function(){const e=new Promise((e=>On=e));return io({type:"current_user"}),e.then((e=>{if(void 0===e)throw new Error("currentUser is only available in unpublished team notebooks");return e}))},Secret:Promise.resolve(Er),DatabaseClient:Promise.resolve(DatabaseClient),__query:Promise.resolve(or)})),Nr=kr.module(),Sr=new Map;function qr({node_id:e,new_node_value:t,new_next_node_id:n,new_node_mode:r}){if(Sr.has(e))throw new Error("duplicate node");const o=new $n(e,r);Sr.set(e,o),Or({node_id:e,new_next_node_id:n}),o.define(t)}function Tr({node_id:e,new_node_value:t,new_node_mode:n}){const r=Pr(e);r.define(t),n&&r.setMode(n)}function Or({node_id:e,new_next_node_id:t}){const n=Pr(e);if(null===t)Cr.insertBefore(n.node,jr);else{const e=Pr(t);Cr.insertBefore(n.node,e.node)}}function Ar({node_id:e}){const t=Pr(e);t.dispose(),Sr.delete(e),Cr.removeChild(t.node)}function $r({node_id:e,height:t}){const n=Sr.get(e);if(n)n.offset(t);else if(0!==t)throw new Error("node not found")}function Lr({name:e}){for(const t of Sr.values())t.fileAttachments.has(e)&&t.run()}function Pr(e){const t=Sr.get(e);if(!t)throw new Error("node not found");return t}function Mr(e=500){return new Promise(((t,n)=>{setTimeout((()=>n(new Error("timeout"))),e)}))}async function Rr(e,t){if(!e._reachable&&e._name){void 0===t&&(t=Mr());const n=Nr.variable(!0).define([e._name],(e=>e));try{return await Promise.race([Nr._runtime._compute().then((()=>n._promise)),t])}catch(e){return}finally{n.delete()}}return e._value}function Ur(e,t){return e&&("function"==typeof e.sql||"function"==typeof e.queryTag&&("function"==typeof e.query||"function"==typeof e.queryStream))&&("table"!==t||"function"==typeof e.schema)&&e!==or}Nr.builtin("FileAttachment",wr);const Ir=new Set(Object.getOwnPropertyNames(Object.prototype));async function Dr({variable:e,paths:t}){let n=await Rr(Nr._resolve(e));if(null==n)return[];for(const e of t){const t=Object.getOwnPropertyDescriptor(n,e)||Object.getOwnPropertyDescriptor(Object.getPrototypeOf(n),e);if(!t||t.get)return[];n=n[e]}return function(e){const t=new Set;for(;null!==e;){for(const n of Object.getOwnPropertyNames(e))/^[a-z]/i.test(n)&&!Ir.has(n)&&t.add(n);e=Object.getPrototypeOf(e)}return t}(n)}const Br="http://www.w3.org/2000/xmlns/",zr="http://www.w3.org/1999/xlink",Fr="http://www.w3.org/2000/svg";async function Wr({id:e,node_id:t,as_view:n,download_type:r,format:o}){const i=Pr(t),a=n?i.valueAsView():i.value(),s=await async function(e,t,n){let r;switch(t){case"svg":{const t=Gr(e);return"svg"===n?async function(e){e=e.cloneNode(!0);const t=location.href+"#",n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);for(;n.nextNode();){const e=n.currentNode;for(const n of e.attributes)n.value.includes(t)&&(n.value=n.value.replace(t,"#"))}e.setAttributeNS(Br,"xmlns",Fr),e.setAttributeNS(Br,"xmlns:xlink",zr);const r=(new XMLSerializer).serializeToString(e);return new Blob([r],{type:"image/svg+xml"})}(t):async function(e){let t,n;const r=new Promise(((e,r)=>(t=e,n=r))),o=new Image;let i=+e.getAttribute("width"),a=+e.getAttribute("height");i&&a||!e.viewBox.baseVal||({width:i,height:a}=e.viewBox.baseVal);i&&a||({width:i,height:a}=e.getBoundingClientRect());i||(i=300);a||(a=150);return o.onerror=n,o.onload=()=>{const e=window.devicePixelRatio||1,n=document.createElement("canvas");n.width=i*e,n.height=a*e;n.getContext("2d").drawImage(o,0,0,i,a,0,0,i*e,a*e),URL.revokeObjectURL(o.src),t(n)},o.src=URL.createObjectURL(await async function(e,t,n){(e=document.body.appendChild(e.cloneNode(!0))).setAttribute("width",t),e.setAttribute("height",n);const r=document.body.appendChild(document.createElementNS(Fr,"svg")),o=getComputedStyle(r),i=location.href+"#",a=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);let c=e;do{for(const e of c.attributes)e.value.includes(i)&&(e.value=e.value.replace(i,"#"));if("image"===c.tagName)try{const e=new URL(c.getAttribute("href"));["https:","blob:"].includes(e.protocol)&&a.push(c)}catch{}const e=getComputedStyle(c);for(const t of e){const n=e[t];n!==o[t]&&n!==c.getAttribute(t)&&(c.style[t]=n)}}while(c=s.nextNode());r.remove(),await Promise.all(a.map((e=>new Promise((t=>{const n=new Image;n.crossOrigin="*",n.onerror=t,n.onload=()=>{const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const o=r.getContext("2d");try{o.drawImage(n,0,0,n.width,n.height),e.setAttribute("href",o.canvas.toDataURL())}catch{}t()},n.src=e.getAttribute("href")}))))),e.setAttributeNS(Br,"xmlns",Fr),e.setAttributeNS(Br,"xmlns:xlink",zr);const l=(new XMLSerializer).serializeToString(e);return e.remove(),new Blob([l],{type:"image/svg+xml"})}(e,i,a)),r}(t).then((e=>new Promise((t=>e.toBlob(t)))))}case"canvas":return new Promise((t=>Xr(e).toBlob(t)));case"blob":return e;case"css":return new Blob([e.textContent.trim()],{type:"text/css"});case"string":return new Blob([e],{type:"text/plain"});case"csv":if("csv"===n){const t=Array.isArray(e[0])?_e(e):we(e);return new Blob([t],{type:"text/csv"})}r=e;break;case"map":case"set":case"typedarray":r=Array.from(e);break;case"array":case"object":r=e}return new Blob([JSON.stringify(r)],{type:"application/json"})}(a,r,o);io({id:e,value:s})}let Hr=0;function Vr(e){if(++Hr>50)return!1;const t=typeof e,n=null==e||"number"===t||"string"===t||"boolean"===t||"toJSON"in e||Kr(e)||Yr(e);return--Hr,n}function Yr(e){if(null==e||"object"!=typeof e)return!1;const t=Object.getPrototypeOf(e);if(t!==Object.prototype&&null!==t)return!1;let n=0;for(const t of Object.values(e)){if("function"===typeof t)return!1;if(!Vr(t))return!1;if(++n>=50)break}return!0}function Kr(e){if(!Array.isArray(e))return!1;let t=0;for(const n of e){if(!Vr(n))return!1;if(++t>=50)break}return!0}function Jr(e){try{return null==e?void 0:Gr(e)?{type:"svg"}:Xr(e)?{type:"canvas"}:function(e){return e instanceof HTMLStyleElement}(e)?{type:"css"}:e instanceof Blob?{type:"blob",mime:e.type}:function(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array}(e)?{type:"typedarray"}:function(e){if(!Array.isArray(e))return!1;let t=0;for(const n of e){let e=null;if(Array.isArray(n))e=n;else{if(!Yr(n))return!1;e=Object.values(n)}let r=0;for(const t of e){const e=typeof t;if(null!=t&&"string"!==e&&"number"!==e&&"boolean"!==e&&!(t instanceof Date))return!1;if(++r>=50)break}if(++t>=50)break}return!0}(e)?{type:"csv"}:Kr(e)?{type:"array"}:Yr(e)?{type:"object"}:function(e){if(e instanceof Map){let t=0;for(const n of e.keys()){const r=typeof n;if("number"!==r&&"string"!==r)return!1;if(!Vr(e.get(n)))return!1;if(++t>=50)break}return!0}return!1}(e)?{type:"map"}:function(e){if(e instanceof Set){let t=0;for(const n of e.values()){if(!Vr(n))return!1;if(++t>=50)break}return!0}return!1}(e)?{type:"set"}:"string"==typeof e?{type:"string"}:void 0}catch{}finally{Hr=0}}function Zr(e,t){const n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return r.width/n.width>=.75||r.height/n.height>=.75}function Gr(e){if(e instanceof SVGSVGElement)return e;if(e instanceof Element){const t=e.querySelectorAll("svg");if(1===t.length&&Zr(e,t[0]))return t[0]}return null}function Xr(e){if(e instanceof HTMLCanvasElement)return e;if(e instanceof Element){const t=e.querySelectorAll("canvas");if(1===t.length&&Zr(e,t[0]))return t[0]}return null}function Qr(){return new URL(document.baseURI).pathname.startsWith("/msteams/")}function eo({pathname:e,search:t,hash:n}){document.querySelector("base").href=`https://observablehq.com${e}${t}${n}`;const r=location.hash;history.replaceState({},"",new URL(t+n,location)),r!==n&&dispatchEvent(new HashChangeEvent("hashchange"))}addEventListener("click",(e=>{if(e.defaultPrevented||e.button&&0!==e.button||e.ctrlKey||e.metaKey||e.altKey||e.shiftKey)return;const t=e.target.closest("a[href]");if(!t)return;if("https:"!==t.protocol||"https://observablehq.com"!==t.origin||"classic"===new URLSearchParams(t.search).get("ui")||t.target&&"_top"!==t.target||t.hasAttribute("download")||function(e){if(!e.hash&&"#"!==e.href.slice(-1))return!1;const t=new URL(document.baseURI);return e.pathname===t.pathname&&e.search===t.search}(t))return void(Qr()&&(t.target="_blank"));let n=t.pathname;if(Qr()){if(!/^\/((@[0-9a-z_-]+\/)|(d\/))/.test(n))return void(t.target="_blank");n="/msteams/notebook"+n}e.preventDefault(),io({type:"navigate",pathname:n,search:t.search,hash:t.hash})}));var to=new Set([["asyncGenerator","async function* a() {}"],["bigInt","0n"],["dynamicImport",'import("")']].filter((([,e])=>function(e){try{return new Function(e),!0}catch(e){return!1}}(e))).map((([e])=>e)));const no="https://observablehq.com",ro=window.parent;function oo(){io({type:"hello",platformSupport:to})}function io(e){ro.postMessage(e,no)}addEventListener("keydown",(function(e){"Escape"!==e.key||e.altKey||e.metaKey||e.ctrlKey||io({type:"escape"})}),!0),addEventListener("message",(function(e){if(!e.isTrusted||e.origin!==no||e.source!==ro)return;e.stopImmediatePropagation();const t=e.data;if("bundle"!==t.type)switch(t.type){case"autocomplete":!async function({id:e,variable:t,paths:n}){io({id:e,value:await Dr({variable:t,paths:n})})}(t);break;case"blur":!function(){getSelection()?.removeAllRanges()}();break;case"hello":oo();break;case"extract_title":!async function({id:e,node_id:t}){const n=Pr(t);await n.resolve();const r=n.node.querySelector("h1");io({id:e,value:r?r.textContent:""})}(t);break;case"resolve_import":!function({id:e,specifier:t,module:n,error:r}){const o=Nn.get(e);if(!o)throw new Error("import not found");Nn.delete(e);const[i,a]=o;void 0===r?i(import(n).catch((()=>{throw new TypeError(`Notebook '${t}' failed to load`)}))):a(new TypeError(r))}(t);break;case"current_user":zn(t);break;case"resolve_secrets":!function({secrets:e}){for(const[t,n]of e)_r.set(t,n);gr&&gr(Er)}(t);break;case"resolve_database_token":!function({error:e,name:t,token:n}){const{resolve:r,reject:o}=Vn.get(t);Vn.delete(t),void 0===e?(n={origin:"https://connector.observableusercontent.com",...JSON.parse(atob(n.split(".")[0])),token:n},Yn.set(t,n),r(n)):o(new Error(e))}(t);break;case"resolve_cloud_file":!function({name:e,url:t,error:n}){if(!ur.has(e))throw new Error("unknown file");if(void 0!==n){const t=pr.get(e);t&&t.reject(new Error(n))}else vr(e,t)}(t);break;case"request_download_type":!function({id:e,node_id:t}){const n=Pr(t);io({id:e,value:{type:Jr(n.value()),typeAsView:Jr(n.valueAsView())}})}(t);break;case"request_download":Wr(t);break;case"report_cell_output_for_testing":!function(){io({type:"report_cell_output_for_testing",content:Array.from(document.getElementsByClassName("observablehq")).map((e=>e.innerText))})}();break;case"request_database_clients":!async function({id:e,mode:t}){const n=[],r=Mr();for(const[e,o]of await Promise.all(Array.from(Nr._scope,(async([e,t])=>[e,await Rr(t,r)]))))Ur(o,t)&&n.push({name:e,dialect:o.dialect});io({id:e,value:n})}(t);break;case"request_database_schema":!async function({id:e,source:t,table:n}){let r;const{name:o,type:i}=t;try{if("cell"===i){const e=Nr._scope.get(o);if(e){const t=await Rr(e);r=await t.schema(n)}}else{const e=await DatabaseClient(o);r=await e.schema(n)}}catch(e){console.error(e)}io({id:e,value:r})}(t);break;default:console.warn("unknown message",t)}else{const{events:e}=t;for(const t of e)switch(t.type){case"insert_node":qr(t);break;case"mode_node":case"modify_node":case"modify_data":case"modify_name":Tr(t);break;case"move_node":Or(t);break;case"remove_node":Ar(t);break;case"offset_node":$r(t);break;case"insert_file":mr(t),Lr(t);break;case"modify_file":br(t);break;case"remove_file":yr(t),Lr(t);break;case"reset_secret":xr(t);break;case"current_user":zn(t);break;case"navigate":eo(t);break;default:console.warn("unknown event",t)}}}),!0),oo();export{io as postMessage};
